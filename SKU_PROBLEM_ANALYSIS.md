# 🚨 SKU取り込み重大問題分析

## 発見された問題

### 1. 複数の選択肢コードが同一SKUに関連付けられている

**異常パターン:**
- SKU 1765: 多数の選択肢コード（R01,R02,R08,R10,R11,R15,R17,R20等）が関連
- SKU 1764: C01,C05,C06,C07,C10,C16,C17,C22等が関連  
- SKU 1804: 複数のRコード選択肢が関連
- SKU 1818: Mコード選択肢が関連
- SKU 2001: Nコード選択肢が関連

### 2. C01の具体的問題

**正しい情報:**
- C01 = ちび袋 エゾ鹿スライスジャーキー 10g
- CM096
- JANコード: 4573265581684
- **SKUコードなし**

**データベースの状況:**
- C01がSKU 1834（廃版）と誤って関連付けられていた
- 1834は2025年に11件の注文記録（異常）

### 3. SKU取り込みシステムの根本問題

**推定される原因:**
1. **楽天APIデータの構造的問題**
   - 選択肢商品のSKU取得ロジックエラー
   - まとめ商品の子商品SKUが親商品に混在

2. **データ処理ロジックの不備**
   - 選択肢コードとrakuten_item_numberの関連付けが間違っている
   - SKUのないまとめ商品の処理が不適切

3. **楽天商品構造の複雑性**
   - 1つの楽天商品に複数選択肢
   - 選択肢ごとに独立したSKUを持つべきが、親商品SKUが割り当てられている

## 緊急対応が必要な事項

### 1. C01マッピングの修正 ✅
- 正しい情報（CM096、JANコード等）でマッピング済み

### 2. SKU取り込みロジックの見直し 🔄
- `daily_sync.py`の楽天API解析部分
- `rakuten_item_number`の取得方法
- 選択肢コードとSKUの関連付けロジック

### 3. 過去データのクレンジング ⏳
- 誤った選択肢コード-SKU関連の修正
- 廃版SKU 1834のデータ調査
- 選択肢商品の正しいマッピング

## 今晩の自動同期への影響

**現在の状況:**
- C01は正しくマッピング済み（CM096）
- 他の選択肢コードも一部は正しく機能
- SKU取り込み問題は継続中だが、選択肢コードベースのマッピングで回避可能

**推奨アクション:**
1. 今晩の自動同期実行（現状でも動作する）
2. 同期結果確認後、SKU取り込みロジックの詳細調査
3. 楽天APIデータの構造再分析

## 長期的修正計画

1. **楽天API解析の改善**
   - 選択肢商品の正しいSKU取得方法
   - まとめ商品と選択肢の関係性理解

2. **データクレンジング**
   - 過去の間違ったSKU関連付けの修正
   - 廃版商品データの除外

3. **マッピングシステムの強化**
   - 選択肢コード優先のマッピング
   - SKU依存度の軽減