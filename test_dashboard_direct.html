<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>æœªãƒãƒƒãƒ”ãƒ³ã‚°å•†å“ç¢ºèª - ç›´æ¥ãƒ†ã‚¹ãƒˆ</title>
    <style>
        body { font-family: sans-serif; margin: 20px; }
        .success { color: green; font-weight: bold; }
        .error { color: red; font-weight: bold; }
        .info { background: #f0f8ff; padding: 15px; border-radius: 5px; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>ğŸ” æœªãƒãƒƒãƒ”ãƒ³ã‚°å•†å“ç¢ºèª</h1>
    <button onclick="checkUnmapped()">å†ç¢ºèª</button>
    
    <div id="status" class="info">ç¢ºèªä¸­...</div>
    <div id="result"></div>
    
    <script>
        async function checkUnmapped() {
            const status = document.getElementById('status');
            const result = document.getElementById('result');
            
            status.textContent = 'APIã‚’å‘¼ã³å‡ºã—ä¸­...';
            status.className = 'info';
            
            try {
                const response = await fetch('https://sizuka-inventory-system-1025485420770.asia-northeast1.run.app/api/unmapped_products');
                const data = await response.json();
                
                if (data.status === 'success') {
                    if (data.unmapped_count === 0) {
                        status.textContent = 'âœ… ã™ã¹ã¦ã®å•†å“ãŒãƒãƒƒãƒ”ãƒ³ã‚°æ¸ˆã¿ã§ã™';
                        status.className = 'success';
                        result.innerHTML = `
                            <h3>ãƒãƒƒãƒ”ãƒ³ã‚°å®Œäº† ğŸ‰</h3>
                            <ul>
                                <li>æœªãƒãƒƒãƒ”ãƒ³ã‚°å•†å“: 0ä»¶</li>
                                <li>ã‚µãƒ³ãƒ—ãƒ«ç¢ºèª: ${data.sample_size}ä»¶</li>
                                <li>ãƒãƒƒãƒ”ãƒ³ã‚°ç‡: 100%</li>
                            </ul>
                            <p><strong>C01é¸æŠè‚¢ã‚³ãƒ¼ãƒ‰ï¼ˆã‚¿ã‚ªãƒ«ã‚»ãƒƒãƒˆï¼‰ã‚‚æ­£ã—ããƒãƒƒãƒ”ãƒ³ã‚°ã•ã‚Œã¦ã„ã¾ã™ã€‚</strong></p>
                        `;
                    } else {
                        status.textContent = `âš ï¸ ${data.unmapped_count}ä»¶ã®æœªãƒãƒƒãƒ”ãƒ³ã‚°å•†å“ãŒã‚ã‚Šã¾ã™`;
                        status.className = 'error';
                        result.innerHTML = '<h3>æœªãƒãƒƒãƒ”ãƒ³ã‚°å•†å“:</h3>';
                        data.unmapped_products.forEach(product => {
                            result.innerHTML += `
                                <div style="border: 1px solid #ccc; margin: 10px 0; padding: 10px;">
                                    <strong>${product.product_name}</strong><br>
                                    é¸æŠè‚¢ã‚³ãƒ¼ãƒ‰: ${product.choice_code || '-'}<br>
                                    æ¥½å¤©SKU: ${product.rakuten_item_number || '-'}<br>
                                    æ•°é‡: ${product.total_quantity}å€‹
                                </div>
                            `;
                        });
                    }
                } else {
                    status.textContent = 'APIã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ';
                    status.className = 'error';
                    result.textContent = data.message;
                }
            } catch (error) {
                status.textContent = 'ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ';
                status.className = 'error';
                result.textContent = error.message;
            }
        }
        
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«è‡ªå‹•å®Ÿè¡Œ
        document.addEventListener('DOMContentLoaded', checkUnmapped);
    </script>
</body>
</html>